31 Автоматическая генерация значения ID (Автоинкремент, Serial)

В БД есть колонка ID
Эта колонка должна уникально иденифицировать человека
На данные момент в PersonDAO мы всем людям в методе save()
вручную присваиваем id = 1;

В данном случае мы будем присваивать id на стороне базы данных
В разных базах это делается по-разному, в MуSQL это называется
автоинкремент.

---

В PostgreSQL есть особый объект sequence
Команда в SQL:

create sequence first_sequence

В папке с базой создается папка sequence
с нашим объектом first_sequence;

Для пользования этим объектом
вызываем команду
select nextval('first_sequence');

При каждом следующем обращении объект
возвращает число на 1 больше

---

Переделаем нашу таблицу, чтобы она была
связана с sequence, т.е. имела автоматизацию
поля id.
Для этого используем специальный тип данных
serial
.
create table Person(
    id serial,
    name varchar,
    age int,
    email varchar
);
.
Вместе с таблицей создается не только
int, но и sequences в отдельной папке
(person_id_seq) привязывается к id.
Скаждым добавлением человека будет вызыватся
sequences и добавлять единицу

---

Примечание.
Во всех версиях, после 10
поле SERIAL заменили на
id int generated by default as identity;

---
После того, как мы передали генерацию id
базе данных, мы должны переписать PersonDAO
(lesson 21)





